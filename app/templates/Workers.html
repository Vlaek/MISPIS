{% extends 'base.html' %}

{% block title %}
    Сотрудники
{% endblock %}

{%block header%}
    <h3  class="my-0 mr-md-auto text-white">Сотрудники</h3>
    <button onclick="document.getElementById('id01').style.display='block'">Добавить сотрудника</button>
    <a href="/">Главная</a>
{% endblock %}

{% block body %}
<form method="post">
    <div id="id01" class="modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Добавление сотрудника</h5>
                    <button type="button" id="kreuz" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <input class="form-control" id="Vorname" maxlength="100" name="Vorname"
                   placeholder="Введите имя сотрудника"><br>
                    <input class="form-control" id="Nachname" maxlength="100" name="Nachname"
                   placeholder="Введите фамилию сотрудника"><br>
                    <div class="form-group">
                    <input id="DOB" max="2038-01-19T22:23:59" min="1900-01-01T00:00:00" name="DOB"
                       onchange="OnChange() Init()" type="date"/>
                    <label> - Дата рождения </label>
                    <br>
                    <select id="speciality" name="speciality">
                        <option>Инженер</option>
                        <option>Техник</option>
                        <option>Лаборант</option>
                        <option>Конструктор</option>
                        <option>Обслуживающий персонал</option>
                    </select>
                    <label> - Специальность </label>
                    <br>
                    <select id="position" name="position">
                        <option>Рабочий</option>
                        <option>Начальник</option>
                    </select>
                    <label> - Должность </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" id="random">Зарандомить</button>
                    <input type="submit" name="action" value="Добавить">
                    <button type="button" id="cancel" data-dismiss="modal">Отмена</button>
                </div>
            </div>
        </div>
    </div>
</form>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script></script>
<script>
var modal = document.getElementById('id01');

window.onclick = function(event) {
    if (event.target == modal) {
        modal.style.display = "none";
    };

    cancel.onclick = function() {
        modal.style.display = "none";
    };

    kreuz.onclick = function() {
        modal.style.display = "none";
    };

    function getRandomInRange(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function formatDate(year, month, day) {

      if (day < 10) day = '0' + day;

      if (month < 10) month = '0' + month;

      return year + '-' + month + '-' + day;
    }

    random.onclick = function(){
        $( document ).ready(function(){
            var url = "https://api.randomdatatools.ru/?count=10&params=LastName,FirstName,DateOfBirth";
            $.getJSON( url, {
                format: "json"
            })
            .done(function( data ) {
                document.getElementById('Vorname').value = data[1]["FirstName"];
                document.getElementById('Nachname').value = data[1]["LastName"];
                document.getElementById('DOB').value = formatDate(getRandomInRange(1950, 2002), getRandomInRange(1, 12), getRandomInRange(1,28));
                let o1 = getRandomInRange(0, 4)
                if (o1 == 0)
                {
                    document.querySelector('#s1').value = "Инженер";
                }
                if (o1 == 1)
                {
                    document.querySelector('#s1').value = "Техник";
                }
                if (o1 == 2)
                {
                    document.querySelector('#s1').value = "Конструктор";
                }
                if (o1 == 3)
                {
                    document.querySelector('#s1').value = "Лаборант";
                }
                if (o1 == 4)
                {
                    document.querySelector('#s1').value = "Обслуживающий персонал";
                }
            });
        });
    };
}
</script>
<body bgcolor="#c0c0c0">
    <form method="post" >
        <table class="table table-bordered table-dark">
          <thead>
            <tr>
                <th scope="col">id</th>
                <th scope="col">Имя сотрудника</th>
                <th scope="col">Дата рождения</th>
                <th scope="col">Возраст</th>
                <th scope="col">Специальность</th>
                <th scope="col">Должность</th>
            </tr>
          </thead>
          <tbody>
            <tr>
                {% for row in results %}
                <th scope="col">{{ row.idWorker }}</th>
                <th scope="col">{{ row.Nachname }} {{ row.Vorname }}</th>
                <th scope="col">{{ row.DOB }}</th>
                <th scope="col">{{ row.Age }}</th>
                <th scope="col">{{ row.Speciality }}</th>
                <th scope="col">{{ row.Position }}</th>
            </tr>
            {% endfor %}
          </tbody>
            <td colspan="6">Количество сотрудников {{ length }}</td>

        </table>
    </form>
</body>
{% endblock %}